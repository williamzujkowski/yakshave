{% extends "base.html" %}

{% block title %}{{ config.report.title }} - Leaderboards{% endblock %}
{% block nav_leaderboards %}active{% endblock %}
{% block canonical_page %}leaderboards.html{% endblock %}
{% block og_page %}leaderboards.html{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Leaderboards - {{ config.report.title }}",
  "description": "Rankings and bragging rights for {{ config.github.windows.year }}",
  "url": "{{ base_url }}/{{ config.github.windows.year }}/leaderboards.html",
  "inLanguage": "en",
  "isPartOf": {
    "@type": "WebSite",
    "name": "{{ config.report.title }}",
    "url": "{{ base_url }}/"
  }
}
</script>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Leaderboards</h1>
    <p class="lead">Rankings and bragging rights for {{ config.github.windows.year }}</p>
</div>

<section class="leaderboard-tabs-section">
    <div class="tabs">
        <button class="tab-button active" data-tab="prs">Pull Requests</button>
        <button class="tab-button" data-tab="reviews">Code Reviews</button>
        <button class="tab-button" data-tab="issues">Issues</button>
        <button class="tab-button" data-tab="comments">Comments</button>
        <button class="tab-button" data-tab="overall">Overall</button>
    </div>

    <!-- Pull Requests Tab -->
    <div class="tab-content active" id="tab-prs">
        <div class="leaderboard-grid">
            <div class="leaderboard-card">
                <h3>Most PRs Merged</h3>
                <div class="podium">
                    {% for contributor in leaderboards.prs_merged[:3] %}
                    <div class="podium-item podium-{{ loop.index }}">
                        <div class="podium-rank">
                            {% if loop.index == 1 %}
                            <svg width="32" height="32" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                                <path d="M9.669.864 8 0 6.331.864l-1.858.282-.842 1.68-1.337 1.32L2.6 6l-.306 1.854 1.337 1.32.842 1.68 1.858.282L8 12l1.669-.864 1.858-.282.842-1.68 1.337-1.32L13.4 6l.306-1.854-1.337-1.32-.842-1.68z"/>
                            </svg>
                            {% elif loop.index == 2 %}
                            <svg width="28" height="28" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                                <path d="M9.669.864 8 0 6.331.864l-1.858.282-.842 1.68-1.337 1.32L2.6 6l-.306 1.854 1.337 1.32.842 1.68 1.858.282L8 12l1.669-.864 1.858-.282.842-1.68 1.337-1.32L13.4 6l.306-1.854-1.337-1.32-.842-1.68z"/>
                            </svg>
                            {% else %}
                            <svg width="24" height="24" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                                <path d="M9.669.864 8 0 6.331.864l-1.858.282-.842 1.68-1.337 1.32L2.6 6l-.306 1.854 1.337 1.32.842 1.68 1.858.282L8 12l1.669-.864 1.858-.282.842-1.68 1.337-1.32L13.4 6l.306-1.854-1.337-1.32-.842-1.68z"/>
                            </svg>
                            {% endif %}
                        </div>
                        <div class="podium-avatar">
                            <img src="{{ contributor.avatar_url | default('https://github.com/identicons/' + contributor.login + '.png') }}"
                                 alt="{{ contributor.login }}">
                        </div>
                        <div class="podium-name">{{ contributor.login }}</div>
                        <div class="podium-value">{{ contributor.value }}</div>
                    </div>
                    {% endfor %}
                </div>
                <div class="leaderboard-list">
                    {% for contributor in leaderboards.prs_merged[3:10] %}
                    <div class="leaderboard-item">
                        <span class="rank">{{ loop.index + 3 }}</span>
                        <div class="contributor-info">
                            <img src="{{ contributor.avatar_url | default('https://github.com/identicons/' + contributor.login + '.png') }}"
                                 alt="{{ contributor.login }}"
                                 class="mini-avatar">
                            <span class="name">{{ contributor.login }}</span>
                        </div>
                        <span class="value">{{ contributor.value }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="leaderboard-card">
                <h3>Most PRs Opened</h3>
                <div class="leaderboard-list">
                    {% for contributor in leaderboards.prs_opened[:10] %}
                    <div class="leaderboard-item">
                        <span class="rank">{{ loop.index }}</span>
                        <div class="contributor-info">
                            <img src="{{ contributor.avatar_url | default('https://github.com/identicons/' + contributor.login + '.png') }}"
                                 alt="{{ contributor.login }}"
                                 class="mini-avatar">
                            <span class="name">{{ contributor.login }}</span>
                        </div>
                        <span class="value">{{ contributor.value }}{{ trend_indicator(contributor.value, 10, 2, '', false) }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Reviews Tab -->
    <div class="tab-content" id="tab-reviews">
        <div class="leaderboard-grid">
            <div class="leaderboard-card">
                <h3>Most Reviews Submitted</h3>
                <div class="podium">
                    {% for contributor in leaderboards.reviews_submitted[:3] %}
                    <div class="podium-item podium-{{ loop.index }}">
                        <div class="podium-rank">
                            {% if loop.index == 1 %}
                            <svg width="32" height="32" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                                <path d="M9.669.864 8 0 6.331.864l-1.858.282-.842 1.68-1.337 1.32L2.6 6l-.306 1.854 1.337 1.32.842 1.68 1.858.282L8 12l1.669-.864z"/>
                            </svg>
                            {% elif loop.index == 2 %}
                            <svg width="28" height="28" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                                <path d="M9.669.864 8 0 6.331.864l-1.858.282-.842 1.68-1.337 1.32L2.6 6l-.306 1.854 1.337 1.32.842 1.68 1.858.282L8 12l1.669-.864z"/>
                            </svg>
                            {% else %}
                            <svg width="24" height="24" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                                <path d="M9.669.864 8 0 6.331.864l-1.858.282-.842 1.68-1.337 1.32L2.6 6l-.306 1.854 1.337 1.32.842 1.68 1.858.282L8 12l1.669-.864z"/>
                            </svg>
                            {% endif %}
                        </div>
                        <div class="podium-avatar">
                            <img src="{{ contributor.avatar_url | default('https://github.com/identicons/' + contributor.login + '.png') }}"
                                 alt="{{ contributor.login }}">
                        </div>
                        <div class="podium-name">{{ contributor.login }}</div>
                        <div class="podium-value">{{ contributor.value }}</div>
                    </div>
                    {% endfor %}
                </div>
                <div class="leaderboard-list">
                    {% for contributor in leaderboards.reviews_submitted[3:10] %}
                    <div class="leaderboard-item">
                        <span class="rank">{{ loop.index + 3 }}</span>
                        <div class="contributor-info">
                            <img src="{{ contributor.avatar_url | default('https://github.com/identicons/' + contributor.login + '.png') }}"
                                 alt="{{ contributor.login }}"
                                 class="mini-avatar">
                            <span class="name">{{ contributor.login }}</span>
                        </div>
                        <span class="value">{{ contributor.value }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="leaderboard-card">
                <h3>Most Approvals</h3>
                <div class="leaderboard-list">
                    {% for contributor in leaderboards.approvals[:10] %}
                    <div class="leaderboard-item">
                        <span class="rank">{{ loop.index }}</span>
                        <div class="contributor-info">
                            <img src="{{ contributor.avatar_url | default('https://github.com/identicons/' + contributor.login + '.png') }}"
                                 alt="{{ contributor.login }}"
                                 class="mini-avatar">
                            <span class="name">{{ contributor.login }}</span>
                        </div>
                        <span class="value">{{ contributor.value }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="leaderboard-card">
                <h3>Most Changes Requested</h3>
                <div class="leaderboard-list">
                    {% for contributor in leaderboards.changes_requested[:10] %}
                    <div class="leaderboard-item">
                        <span class="rank">{{ loop.index }}</span>
                        <div class="contributor-info">
                            <img src="{{ contributor.avatar_url | default('https://github.com/identicons/' + contributor.login + '.png') }}"
                                 alt="{{ contributor.login }}"
                                 class="mini-avatar">
                            <span class="name">{{ contributor.login }}</span>
                        </div>
                        <span class="value">{{ contributor.value }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Issues Tab -->
    <div class="tab-content" id="tab-issues">
        <div class="leaderboard-grid">
            <div class="leaderboard-card">
                <h3>Most Issues Opened</h3>
                <div class="leaderboard-list">
                    {% for contributor in leaderboards.issues_opened[:10] %}
                    <div class="leaderboard-item">
                        <span class="rank">{{ loop.index }}</span>
                        <div class="contributor-info">
                            <img src="{{ contributor.avatar_url | default('https://github.com/identicons/' + contributor.login + '.png') }}"
                                 alt="{{ contributor.login }}"
                                 class="mini-avatar">
                            <span class="name">{{ contributor.login }}</span>
                        </div>
                        <span class="value">{{ contributor.value }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="leaderboard-card">
                <h3>Most Issues Closed</h3>
                <div class="leaderboard-list">
                    {% for contributor in leaderboards.issues_closed[:10] %}
                    <div class="leaderboard-item">
                        <span class="rank">{{ loop.index }}</span>
                        <div class="contributor-info">
                            <img src="{{ contributor.avatar_url | default('https://github.com/identicons/' + contributor.login + '.png') }}"
                                 alt="{{ contributor.login }}"
                                 class="mini-avatar">
                            <span class="name">{{ contributor.login }}</span>
                        </div>
                        <span class="value">{{ contributor.value }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Comments Tab -->
    <div class="tab-content" id="tab-comments">
        <div class="leaderboard-grid">
            <div class="leaderboard-card">
                <h3>Most Comments Total</h3>
                <div class="leaderboard-list">
                    {% for contributor in leaderboards.comments_total[:10] %}
                    <div class="leaderboard-item">
                        <span class="rank">{{ loop.index }}</span>
                        <div class="contributor-info">
                            <img src="{{ contributor.avatar_url | default('https://github.com/identicons/' + contributor.login + '.png') }}"
                                 alt="{{ contributor.login }}"
                                 class="mini-avatar">
                            <span class="name">{{ contributor.login }}</span>
                        </div>
                        <span class="value">{{ contributor.value }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="leaderboard-card">
                <h3>Most Review Comments</h3>
                <div class="leaderboard-list">
                    {% for contributor in leaderboards.review_comments_total[:10] %}
                    <div class="leaderboard-item">
                        <span class="rank">{{ loop.index }}</span>
                        <div class="contributor-info">
                            <img src="{{ contributor.avatar_url | default('https://github.com/identicons/' + contributor.login + '.png') }}"
                                 alt="{{ contributor.login }}"
                                 class="mini-avatar">
                            <span class="name">{{ contributor.login }}</span>
                        </div>
                        <span class="value">{{ contributor.value }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Overall Tab -->
    <div class="tab-content" id="tab-overall">
        <div class="leaderboard-card leaderboard-card-wide">
            <h3>Overall Contribution Ranking</h3>
            <p class="card-description">Weighted ranking across all contribution types</p>
            <div class="table-responsive">
                <table class="data-table" data-exportable data-export-name="leaderboard-overall.csv">
  <caption class="visually-hidden">Contributor rankings by overall score</caption>
  <thead>
                        <tr>
                            <th scope="col">Rank</th>
                            <th scope="col">Contributor</th>
                            <th scope="col">PRs</th>
                            <th scope="col">Reviews</th>
                            <th scope="col">Issues</th>
                            <th scope="col">Comments</th>
                            <th scope="col">Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for contributor in leaderboards.overall[:20] %}
                        <tr>
                            <td class="rank-cell">{{ loop.index }}</td>
                            <td class="contributor-cell">
                                <div class="contributor-mini">
                                    <img src="{{ contributor.avatar_url | default('https://github.com/identicons/' + contributor.login + '.png') }}"
                                         alt="{{ contributor.login }}"
                                         class="mini-avatar">
                                    <a href="https://github.com/{{ contributor.login }}"
                                       target="_blank"
                                       rel="noopener noreferrer">
                                        {{ contributor.login }}
                                    </a>
                                </div>
                            </td>
                            <td>{{ contributor.prs_merged | default(0) }}</td>
                            <td>{{ contributor.reviews_submitted | default(0) }}</td>
                            <td>{{ contributor.issues_closed | default(0) }}</td>
                            <td>{{ contributor.comments_total | default(0) }}</td>
                            <td>
                                <span class="score-badge score-high">{{ contributor.overall_score | default(0) }}</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>

<section class="comparison-section">
    <h2>Compare Contributors</h2>
    <div class="comparison-tool">
        <div class="comparison-select">
            <label for="compare-contributor-1" class="visually-hidden">Select first contributor</label>
            <select id="compare-contributor-1" class="filter-select">
                <option value="">Select contributor 1...</option>
                {% for contributor in all_contributors %}
                <option value="{{ contributor.user_id }}">{{ contributor.login }}</option>
                {% endfor %}
            </select>
            <span class="vs-label">vs</span>
            <label for="compare-contributor-2" class="visually-hidden">Select second contributor</label>
            <select id="compare-contributor-2" class="filter-select">
                <option value="">Select contributor 2...</option>
                {% for contributor in all_contributors %}
                <option value="{{ contributor.user_id }}">{{ contributor.login }}</option>
                {% endfor %}
            </select>
            <button id="compare-btn" class="btn btn-primary">Compare</button>
        </div>
        <div id="comparison-result" class="comparison-result" style="display: none;">
            <!-- Comparison chart will be rendered here -->
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="assets/js/charts.js"></script>
<script src="assets/js/leaderboards.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Load leaderboard data
    const leaderboardsData = {{ leaderboards | tojson }};
    const allContributorsData = {{ all_contributors | tojson }};

    // Initialize leaderboard tabs
    if (typeof initLeaderboardTabs === 'function') {
        initLeaderboardTabs();
    }

    // Initialize comparison tool
    if (typeof initComparisonTool === 'function') {
        initComparisonTool(allContributorsData);
    }
});
</script>
{% endblock %}
